<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.46, maximum-scale=0.46, user-scalable=no">
  <title>Game SodroN</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
  :root {
      --primary-color: #2ecc71;
      --secondary-color: #3498db;
      --accent-color: #e74c3c;
       --accent-color22: green;
      --dark-color: #2c3e50;
      --light-color: #ecf0f1;
      --gold-color: #f1c40f;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --glow: 0 0 15px rgba(46, 204, 113, 0.5);
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      text-align: center;
      padding: 20px;
      color: var(--light-color);
      min-height: 90vh;
      touch-action: manipulation;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(44, 62, 80, 0.8);
      border-radius: 20px;
      padding: 25px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    h1 {
      color: var(--gold-color);
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      background: linear-gradient(to right, var(--gold-color), #e67e22);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .header {
      position: relative;
      margin-bottom: 14px;
    }
    
    .header::after {
      content: '';
      display: block;
      width: 100px;
      height: 4px;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      margin: 10px auto;
      border-radius: 2px;
    }
    
    #timer {
      font-size: 1.7rem;
      font-weight: bold;
      color: var(--accent-color);
      margin: 15px 0;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px;
      border-radius: 10px;
      display: inline-block;
      min-width: 200px;
      border: 1px solid var(--accent-color);
      box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
    }
    
    .player-info {
      font-size: 2rem;
      margin-bottom: 20px;
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .player-info span {
      font-weight: bold;
      color: var(--gold-color);
    }
    
    .bets {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
    }
    
    .bets button {
      background: var(--dark-color);
      color: var(--light-color);
      padding: 12px 20px;
      margin: 0;
      border: none;
      border-radius: 10px;
      font-size: 1.9rem;
      cursor: pointer;
      transition: all 0.05s ease;
      font-weight: 600;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.1);
      min-width: 100px;
      position: relative;
      overflow: hidden;
    }
    
    .bets button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        to bottom right,
        rgba(255, 255, 255, 0.3) 0%,
        rgba(255, 255, 255, 0) 60%
      );
      transform: rotate(30deg);
      transition: all 0.3s;
    }
    
    .bets button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }
    
    .bets button:hover::before {
      left: 100%;
    }
    
    .bets button.active {
      background: var(--primary-color);
      color: var(--dark-color);
      border: 2px solid var(--gold-color);
      transform: scale(1.05);
      box-shadow: var(--glow);
    }
    
    .items {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 30px;
  max-width: 500px;
  height: 700px;
  margin: 30px auto;
  padding: 20px;
  
  background: rgba(255, 255, 255, 0.1);
  border: 3px solid var(--secondary-color);
  box-shadow: 
  inset 0 -5px 10px rgba(0, 0, 0, 0.2);
  border-radius: 20px;
  position: relative;
}

.item {
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid var(--secondary-color);
  width: 140px;
  height: 110px;
  border-radius: 50%;
  font-size: 6rem;
  position: relative;
  cursor: pointer;
  transition: all 0.02s ease;
  box-shadow: var(--shadow);
  backdrop-filter: blur(5px);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
  /* Efek pemisah tambahan */
  box-shadow: 0 0 0 5px rgba(0,0,0,0.1) inset;
}
    
    .item.disabled {
      opacity: 0.5;
      pointer-events: none;
      filter: grayscale(80%);
    }
    
    .bet-label {
      position: absolute;
      top: -10px;
      right: -10px;
      background: var(--gold-color);
      color: var(--dark-color);
      padding: 5px 10px;
      border-radius: 50px;
      font-size: 1.2rem;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      min-width: 30px;
      text-align: center;
      z-index: 1;
    }
    
    .multiplier {
      position: absolute;
      bottom: 10px;
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--gold-color);
      background: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
      padding: 2px 6px;
    }
    
    #resultMessage {
      font-size: 1.7rem;
      margin: 10px;
      color: var(--gold-color);
      font-weight: bold;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .history {
      margin-top: 20px;
      background: rgba(0, 0, 0, 0.2);
      padding: 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .win-history-containerX {
      background: rgba(0, 0, 0, 0.3);
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .win-history-container h3 {
      margin: 0;
      color: var(--gold-color);
      font-size: 0.1rem;
    }
    
    .total-bet-containerX {
      background: rgba(0, 0, 0, 0.3);
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .total-bet-container h3 {
      margin: 0;
      color: var(--gold-color);
      font-size: 0.7rem;
    }
    
    #lastWin, #totalWin, #totalBet {
      color: var(--primary-color);
    }
    
    .history h3 {
      margin-bottom: 15px;
      color: var(--light-color);
      font-size: 1.2rem;
    }
    
    .history span {
      display: inline-block;
      margin: 5px;
      padding: 10px 15px;
      border-radius: 10px;
      font-size: 2rem;
      background: rgba(0, 0, 0, 0.4);
      transition: all 0.3s ease;
    }
    
    .history .latest {
      background: var(--primary-color);
      color: var(--dark-color);
      font-weight: bold;
      transform: scale(1.1);
      box-shadow: 0 0 14px rgba(255, 223, 0, 0.9);
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: var(--gold-color);
      opacity: 0;
    }
    
    .audio-panel {
      position: fixed;
      bottom: 10px;
      right: 250px;
      background: rgba(44, 62, 80, 0.9);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 1000;
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(5px);
      transform: translateY(150%);
      transition: transform 0.3s ease;
    }
    
    .audio-panel.show {
      transform: translateY(0);
    }
    
    .audio-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      font-size: 30px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    
    .audio-control {
      display: flex;
      align-items: center;
      margin: 10px 0;
      color: white;
    }
    
    .audio-control label {
      margin-right: 10px;
      width: 120px;
      font-size: 16px;
    }
    
    .audio-control input[type="range"] {
      width: 230px;
    }
    
    .audio-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 40px;
      margin-left: 10px;
    }
    
    .audio-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .audio-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .audio-slider:before {
      position: absolute;
      content: "⚪»»»»»»";
      height: 24px;
      width: 24px;
      left: 20px;
      bottom: 10px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .audio-slider {
      background-color: #2ecc71;
    }
    
    input:checked + .audio-slider:before {
      transform: translateX(26px);
    }
    
    /* Selection Ball Styles */
    .selection-ball {
      position: absolute;
      width: 50px;
      height: 60px;
      background: radial-gradient(circle at 30% 30%, #fff, var(--gold-color));
      border-radius: 50%;
      box-shadow: 0 0 30px var(--gold-color), 0 0 50px rgba(255, 215, 0, 0.1);
      z-index: 10;
      transition: transform 0.7s ease-out;
      pointer-events: none;
      display: none;
    }
    
    .item.highlighted {
      transform: scale(1.1);
      box-shadow: 0 0 20px var(--gold-color);
      z-index: 5;
    }
    
    @media (max-width: 600px) {
      .items {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      
      .item {
        width: 120px;
        height: 120px;
        font-size: 3rem;
      }
      
      .multiplier {
        font-size: 0.9rem;
        bottom: 8px;
      }
      
      .bets button {
        padding: 10px 15px;
        font-size: 1.2rem;
        min-width: 80px;
      }
      
      .player-info {
        font-size: 1.5rem;
      }
      
      .selection-ball {
        width: 40px;
        height: 40px;
      }
    }
    
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
    }
    
    @keyframes slideDown {
      from { top: -50px; opacity: 0; }
      to { top: 20px; opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>🎮 Game SodroN 🎮</h1>
  </div>
  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjrbCjx5n1921kpvkLj67LPwjWEmr3SHPYMtM96UONsoeXyphFqfAJTvotHZ2nJtvjaHy7uYLnZA7fx02KLL0iXcgxJD1torhgGR6czVMVLmBk5jb6NCZZD6tnxeg6vXQK-oyHh5PiYt0Q/s1600/monkey.gif" alt="SodroN" width="100px;" height="100px;">
  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjrbCjx5n1921kpvkLj67LPwjWEmr3SHPYMtM96UONsoeXyphFqfAJTvotHZ2nJtvjaHy7uYLnZA7fx02KLL0iXcgxJD1torhgGR6czVMVLmBk5jb6NCZZD6tnxeg6vXQK-oyHh5PiYt0Q/s1600/monkey.gif" alt="SodroN" width="90px;" height="90px;">
  <div id="timer" class="pulse">Waktu betting: 8</div>
  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjrbCjx5n1921kpvkLj67LPwjWEmr3SHPYMtM96UONsoeXyphFqfAJTvotHZ2nJtvjaHy7uYLnZA7fx02KLL0iXcgxJD1torhgGR6czVMVLmBk5jb6NCZZD6tnxeg6vXQK-oyHh5PiYt0Q/s1600/monkey.gif" alt="SodroN" width="90px;" height="90px;">
  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjrbCjx5n1921kpvkLj67LPwjWEmr3SHPYMtM96UONsoeXyphFqfAJTvotHZ2nJtvjaHy7uYLnZA7fx02KLL0iXcgxJD1torhgGR6czVMVLmBk5jb6NCZZD6tnxeg6vXQK-oyHh5PiYt0Q/s1600/monkey.gif" alt="SodroN" width="100px;" height="100px;">

  <div id="resultMessage"></div>

  <div class="items" id="itemList">
    <!-- Selection ball will be added here by JavaScript -->
    <div class="selection-ball" id="selectionBall"></div>
  </div>
  <div class="win-history-container">
    <small>Total Bet: <span id="totalBet">0</span> | Total Kemenangan: <span id="totalWin">0</span></small>
  </div>
  <div class="total-bet-container">
    <small>Kemenangan Sebelumnya: <span id="lastWin">0</span></small>
  </div>
    <div class="bets">
    <button data-bet="100" onclick="setBetAmount(100)">Bet 100</button>
    <button data-bet="500" onclick="setBetAmount(500)">Bet 500</button>
    <button data-bet="1000" onclick="setBetAmount(1000)">Bet 1K</button>
    <button data-bet="5000" onclick="setBetAmount(5000)">Bet 5K</button>
    <button data-bet="10000" onclick="setBetAmount(10000)">Bet 10K</button>
    <button onclick="repeatBet()" style="background: var(--accent-color22);">Repeat Bet</button>
    <button onclick="resetGame()" style="background: var(--accent-color);">Reset Game</button>
  </div>
  <div class="history">
    <h2>👈[Histori Pengeluaran]</h2>
    <div id="history"></div>
  </div>
  <div class="player-info">
    Player: <span>SodroN</span> | Saldo: 💎<span id="saldo">75.000</span>
    </div>
</div>

<!-- Audio elements -->
<audio id="bgMusic" loop>
  <source src="https://assets.mixkit.co/active_storage/sfx/2472/2472-preview.mp3" type="audio/mpeg">
</audio>
<audio id="betSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/2597/2597-preview.mp3" type="audio/mpeg">
</audio>
<audio id="spinSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/254/254-preview.mp3" type="audio/mpeg">
</audio>
<audio id="resultSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/2462/2462-preview.mp3" type="audio/mpeg">
</audio>
<audio id="winSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/2576/2576-preview.mp3" type="audio/mpeg">
</audio>
<audio id="clickSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/2595/2595-preview.mp3" type="audio/mpeg">
</audio>
<audio id="errorSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/257/257-preview.mp3" type="audio/mpeg">
</audio>

<audio id="spinningSound">
  <source src="https://www.fesliyanstudios.com/play-mp3/6626" type="audio/mpeg">
</audio>

<!-- Audio Control Panel -->
<div class="audio-toggle" onclick="toggleAudioPanel()">🔊</div>
<div class="audio-panel" id="audioPanel">
  <h3 style="margin-top:0;color:var(--gold-color);text-align:center;">Audio Settings</h3>
  <div class="audio-control">
    <label>Audio</label>
    <label class="audio-switch">
      <input type="checkbox" id="musicToggle">
      <span class="audio-slider"></span>
    </label>
  </div>
  
  <div class="audio-control">
    <label>Audio Volume</label>
    <input type="range" id="musicVolume" min="0" max="1" step="0.1" value="0.5">
  </div>
  
  <div class="audio-control">
    <label>Sound Effects</label>
    <label class="audio-switch">
      <input type="checkbox" id="sfxToggle" checked>
      <span class="audio-slider"></span>
    </label>
  </div>
  
  <div class="audio-control">
    <label>SFX Volume</label>
    <input type="range" id="sfxVolume" min="0" max="1" step="0.1" value="0.9">
  </div>
</div>

<script>
/* ---------- DATA ITEM DENGAN PROBABILITAS ---------- */
const items = [
  {emoji: "🐖", multiplier: 2, probability: 45, color: "#f39c12"},
  {emoji: "🐕", multiplier: 5, probability: 18, color: "#e67e22"},
  {emoji: "🐱", multiplier: 8, probability: 10, color: "#d35400"},
  {emoji: "🐅", multiplier: 18, probability: 10, color: "#c0392b"},
  {emoji: "🧸", multiplier: 66, probability: 2, color: "#9b59b6"},
  {emoji: "🦍", multiplier: 50, probability: 3, color: "#3498db"},
  {emoji: "🐒", multiplier: 100, probability: 1, color: "#1abc9c"},
  {emoji: "🐘", multiplier: 88, probability: 1, color: "#2ecc71"},
  {emoji: "🐼", multiplier: 30, probability: 5, color: "#f1c40f"},
  {emoji: "🐸", multiplier: 20, probability: 5, color: "#27ae60"},
];

/* ---------- VARIABEL GAME ---------- */
let saldo = 75000;
let bettingTime = 8;
let selectedBet = 100;
let betsPerItem = {};
let lastBets = {};
let isBettingActive = false;
let timer;
let history = [];
let totalBetAmount = 0;
let lastWinAmount = 0;
let totalWinAmount = 0;
const emojiToIndex = {};
let isMusicOn = false; // Default OFF
let isSfxOn = true;
let currentSpinInterval;
let currentItemIndex = 0;

/* ---------- ELEMENT DOM ---------- */
const saldoDisplay = document.getElementById("saldo");
const itemList = document.getElementById("itemList");
const resultMsg = document.getElementById("resultMessage");
const historyDisplay = document.getElementById("history");
const totalBetDisplay = document.getElementById("totalBet");
const lastWinDisplay = document.getElementById("lastWin");
const totalWinDisplay = document.getElementById("totalWin");
const bgMusic = document.getElementById("bgMusic");
const betSound = document.getElementById("betSound");
const spinSound = document.getElementById("spinSound");
const resultSound = document.getElementById("resultSound");
const winSound = document.getElementById("winSound");
const clickSound = document.getElementById("clickSound");
const errorSound = document.getElementById("errorSound");
const selectionBall = document.getElementById("selectionBall");
const spinningSound = document.getElementById("spinningSound");

/* ---------- FUNGSI LOAD/SAVE DATA ---------- */
function loadGameData() {
  const savedData = localStorage.getItem('gameSodronData');
  if (savedData) {
    const data = JSON.parse(savedData);
    // Pertahankan nilai saldo apa adanya (termasuk 0)
    saldo = data.saldo !== undefined ? data.saldo : 75000;
    history = data.history || [];
    totalBetAmount = data.totalBet || 0;
    lastWinAmount = data.lastWin || 0;
    totalWinAmount = data.totalWin || 0;
  } else {
    // Hanya set ke 75.000 jika benar-benar tidak ada data tersimpan
    saldo = 75000;
  }
  
  saldoDisplay.textContent = saldo.toLocaleString();
  updateTotalBetDisplay();
  updateWinDisplays();
  updateHistoryDisplay();
}

function saveGameData() {
  const data = {
    saldo: saldo,
    history: history,
    totalBet: totalBetAmount,
    lastWin: lastWinAmount,
    totalWin: totalWinAmount
  };
  localStorage.setItem('gameSodronData', JSON.stringify(data));
}

/* ---------- FUNGSI UPDATE TAMPILAN ---------- */
function updateTotalBetDisplay() {
  totalBetDisplay.textContent = totalBetAmount.toLocaleString();
}

function updateWinDisplays() {
  lastWinDisplay.textContent = lastWinAmount.toLocaleString();
  totalWinDisplay.textContent = totalWinAmount.toLocaleString();
}

function updateHistoryDisplay() {
  historyDisplay.innerHTML = history.map((e, i) => 
    `<span class="${i === 0 ? 'latest' : ''}" style="background: ${items[emojiToIndex[e]].color}">${e}</span>`
  ).join('');
}

function resetTotalBet() {
  totalBetAmount = 0;
  updateTotalBetDisplay();
}

/* ---------- RENDER ITEM ---------- */
items.forEach((item, idx) => {
  emojiToIndex[item.emoji] = idx;
  const div = document.createElement("div");
  div.className = "item";
  div.style.borderColor = item.color;
  div.innerHTML = `<div class="bet-label" id="bet-${idx}" style="display:none">0</div>
         ${item.emoji}
         <div class="multiplier">x${item.multiplier}</div>`;
  div.onclick = () => placeBet(idx);
  itemList.appendChild(div);
  betsPerItem[idx] = 0;
});

/* ---------- FUNGSI PILIH NOMINAL BET ---------- */
function setBetAmount(val) {
  selectedBet = val;
  document.querySelectorAll('.bets button[data-bet]').forEach(btn => {
    btn.classList.toggle('active', parseInt(btn.dataset.bet) === val);
  });
  
  playSound('click');
}

/* ---------- FUNGSI PASANG BET ---------- */
function placeBet(idx) {
  if (!isBettingActive) {
    showAlert("Betting belum dimulai!");
    return;
  }
  if (saldo < selectedBet) {
    showAlert("Saldo tidak cukup!");
    return;
  }

  saldo -= selectedBet;
  totalBetAmount += selectedBet;
  saldoDisplay.textContent = saldo.toLocaleString();
  updateTotalBetDisplay();
  saveGameData();

  betsPerItem[idx] += selectedBet;
  const label = document.getElementById(`bet-${idx}`);
  label.textContent = betsPerItem[idx].toLocaleString();
  label.style.display = "block";
  
  // Animate the bet
  const item = document.querySelectorAll('.item')[idx];
  item.style.animation = 'none';
  setTimeout(() => {
    item.style.animation = 'pulse 0.2s';
  }, 10);
  
  playSound('bet');
}

/* ---------- ALERT STYLISH ---------- */
function showAlert(message) {
  const alert = document.createElement('div');
  alert.textContent = message;
  alert.style.position = 'fixed';
  alert.style.top = '20px';
  alert.style.left = '50%';
  alert.style.transform = 'translateX(-50%)';
  alert.style.backgroundColor = '#e74c3c';
  alert.style.color = 'white';
  alert.style.padding = '15px 25px';
  alert.style.borderRadius = '10px';
  alert.style.zIndex = '1000';
  alert.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
  alert.style.animation = 'slideDown 0.5s, fadeOut 0.5s 2.5s';
  document.body.appendChild(alert);
  
  setTimeout(() => {
    document.body.removeChild(alert);
  }, 3000);
  
  playSound('error');
}

/* ---------- AKTIF & NONAKTIF ITEM ---------- */
function toggleItemClickable(enabled) {
  document.querySelectorAll(".item").forEach(el => {
    el.classList.toggle("disabled", !enabled);
  });
}

/* ---------- MULAI RONDE BETTING ---------- */
function startBettingRound() {
  isBettingActive = true;
  bettingTime = 20;
  document.getElementById("timer").textContent = `Waktu betting: ${bettingTime}`;
  document.getElementById("timer").classList.add('pulse');
  toggleItemClickable(true);

  timer = setInterval(() => {
    bettingTime--;
    document.getElementById("timer").textContent = `Waktu betting: ${bettingTime}`;
    
    // Change color when time is running out
    if (bettingTime <= 5) {
      document.getElementById("timer").style.color = '#ff7675';
      document.getElementById("timer").style.animation = 'none';
      setTimeout(() => {
        document.getElementById("timer").style.animation = 'pulse 0.5s infinite';
      }, 10);
    }
    
    if (bettingTime <= 0) {
      clearInterval(timer);
      isBettingActive = false;
      toggleItemClickable(false);
      document.getElementById("timer").classList.remove('pulse');
      runDraw();
    }
  }, 1000);
}

/* ---------- POSITION SELECTION BALL ---------- */
function positionBall(index) {
  const items = document.querySelectorAll('.item');
  if (index >= 0 && index < items.length) {
    const item = items[index];
    const itemRect = item.getBoundingClientRect();
    const containerRect = itemList.getBoundingClientRect();
    
    const ballSize = parseInt(window.getComputedStyle(selectionBall).width);
    const itemSize = parseInt(window.getComputedStyle(item).width);
    
    const x = itemRect.left - containerRect.left + (itemSize / 2) - (ballSize / 2);
    const y = itemRect.top - containerRect.top + (itemSize / 2) - (ballSize / 2);
    
    selectionBall.style.transform = `translate(${x}px, ${y}px)`;
    selectionBall.style.display = 'block';
    
    // Remove highlight from all items
    items.forEach(i => i.classList.remove('highlighted'));
    // Add highlight to current item
    item.classList.add('highlighted');
  }
}

/* ---------- PILIH ITEM BERDASARKAN PROBABILITAS ---------- */
function getRandomItemIndex() {
  const r = Math.random() * 100;
  let acc = 0;
  for (let i = 0; i < items.length; i++) {
    acc += items[i].probability;
    if (r < acc) return i;
  }
  return items.length - 1; //fallback
}

/* ---------- EFEK SPIN & HASIL ---------- */
function runDraw() {
  let spinCount = 80, current = 0;
  const finalResultIndex = getRandomItemIndex();
  playSound('spin');
  playSound('spinning');
  
  // Show the selection ball
  selectionBall.style.display = 'block';
  
  // Rest of your existing runDraw function...
  
  // Start with a random position
  currentItemIndex = Math.floor(Math.random() * items.length);
  positionBall(currentItemIndex);
  
  currentSpinInterval = setInterval(() => {
    currentItemIndex = (currentItemIndex + 1) % items.length;
    positionBall(currentItemIndex);
    
    current++;
    if (current >= spinCount) {
      // Slow down at the end
      if (current >= spinCount + 10) {
        clearInterval(currentSpinInterval);
        spinSound.pause();
        
        // Move to final result with a little bounce effect
        let bounceCount = 0;
        const bounceInterval = setInterval(() => {
          if (bounceCount < 3) {
            // Bounce to nearby items before landing on final
            currentItemIndex = (finalResultIndex + (bounceCount % 2 === 0 ? -1 : 1)) % items.length;
            if (currentItemIndex < 0) currentItemIndex = items.length - 1;
            positionBall(currentItemIndex);
            bounceCount++;
          } else {
            clearInterval(bounceInterval);
            currentItemIndex = finalResultIndex;
            positionBall(currentItemIndex);
            setTimeout(() => {
              revealResult(finalResultIndex);
            }, 500);
          }
        }, 200);
      } else if (current >= spinCount + 5) {
        // Slow down more
        clearInterval(currentSpinInterval);
        currentSpinInterval = setInterval(() => {
          currentItemIndex = (currentItemIndex + 1) % items.length;
          positionBall(currentItemIndex);
          current++;
          
          if (current >= spinCount + 10) {
            clearInterval(currentSpinInterval);
            spinSound.pause();
            spinningSound.pause();
            
            // Move to final result with a little bounce effect
            let bounceCount = 0;
            const bounceInterval = setInterval(() => {
              if (bounceCount < 3) {
                // Bounce to nearby items before landing on final
                currentItemIndex = (finalResultIndex + (bounceCount % 2 === 0 ? -1 : 1)) % items.length;
                if (currentItemIndex < 0) currentItemIndex = items.length - 1;
                positionBall(currentItemIndex);
                bounceCount++;
              } else {
                clearInterval(bounceInterval);
                currentItemIndex = finalResultIndex;
                positionBall(currentItemIndex);
                setTimeout(() => {
                  revealResult(finalResultIndex);
                }, 500);
              }
            }, 200);
          }
        }, 300);
      }
    }
  }, 100);
}

function revealResult(resultIdx) {
  playSound('result');
  
  const {emoji, multiplier, color} = items[resultIdx];
  const betOnResult = betsPerItem[resultIdx] || 0;

  let msg = `Hasil: ${emoji}`;
  if (betOnResult > 0) {
    const reward = betOnResult * multiplier;
    saldo += reward;
    lastWinAmount = reward;
    totalWinAmount += reward;
    msg += `  +💎${reward.toLocaleString()}`;
    updateWinDisplays();
    createConfetti();
    setTimeout(() => playSound('win'), 500);
  }
  
  saldoDisplay.textContent = saldo.toLocaleString();
  saveGameData();
  resultMsg.innerHTML = msg;
  resultMsg.style.borderColor = color;
  updateHistory(emoji);

  lastBets = {...betsPerItem};
  resetTotalBet();
  
  // bersihkan taruhan
  for (const idx in betsPerItem) {
    betsPerItem[idx] = 0;
    document.getElementById(`bet-${idx}`).style.display = "none";
  }

  // jeda 5 detik
  let wait = 5;
  const delay = setInterval(() => {
    resultMsg.innerHTML = `${msg} <small>&nbsp;&nbsp;Next dalam ${wait} detik...</small>`;
    wait--;
    if (wait < 0) {
      clearInterval(delay);
      resultMsg.textContent = "";
      resultMsg.style.borderColor = 'var(--gold-color)';
      selectionBall.style.display = 'none';
      document.querySelectorAll('.item').forEach(i => i.classList.remove('highlighted'));
      startBettingRound();
    }
  }, 1000);
}

function updateHistory(res) {
  history.unshift(res);
  if (history.length > 8) history.pop();
  updateHistoryDisplay();
  saveGameData();
}

/* ---------- CONFETTI EFFECT ---------- */
function createConfetti() {
  const container = document.querySelector('.container');
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.top = -10 + 'px';
    confetti.style.backgroundColor = getRandomColor();
    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
    container.appendChild(confetti);
    
    const animationDuration = Math.random() * 3 + 2;
    
    confetti.style.animation = `confettiFall ${animationDuration}s linear forwards`;
    
    setTimeout(() => {
      confetti.remove();
    }, animationDuration * 2000);
  }
}

function getRandomColor() {
  const colors = ['#f1c40f', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6'];
  return colors[Math.floor(Math.random() * colors.length)];
}

/* ---------- REPEAT BET ---------- */
function repeatBet() {
  if (!isBettingActive) {
    showAlert("Tidak bisa repeat bet di luar waktu betting!");
    return;
  }

  let totalCost = 0;
  for (let idx in lastBets) {
    if (lastBets[idx] > 0) totalCost += lastBets[idx];
  }

  if (saldo < totalCost) {
    showAlert("Saldo tidak cukup untuk repeat bet.");
    return;
  }

  for (let idx in lastBets) {
    idx = parseInt(idx);
    const amount = lastBets[idx];
    if (amount > 0) {
      betsPerItem[idx] += amount;
      saldo -= amount;
      totalBetAmount += amount;
      const label = document.getElementById(`bet-${idx}`);
      label.textContent = betsPerItem[idx].toLocaleString();
      label.style.display = "block";
    }
  }

  saldoDisplay.textContent = saldo.toLocaleString();
  updateTotalBetDisplay();
  saveGameData();
  playSound('click');
}

/* ---------- RESET GAME ---------- */
function resetGame() {
  if (confirm("Apakah anda yakin ingin mereset game? Semua progress akan hilang. saldo: 💎75k ... <ℹ️>untuk menghindari taruhan NaN (sehabis reset silahkan refresh halaman.)🐒selamat Bermain!")) {
    saldo = 75000;
    history = [];
    totalBetAmount = 0;
    lastWinAmount = 0;
    totalWinAmount = 0;
    betsPerItem = {};
    
    // Reset tampilan
    saldoDisplay.textContent = saldo.toLocaleString();
    updateTotalBetDisplay();
    updateWinDisplays();
    historyDisplay.innerHTML = '';
    document.querySelectorAll('.bet-label').forEach(el => {
      el.style.display = 'none';
    });
    
    localStorage.removeItem('gameSodronData');
    showAlert("Game telah direset!");
  }
}

/* ---------- SOUND EFFECTS ---------- */
function playSound(type) {
  if (!isSfxOn) return;
  
  try {
    let sound;
    switch(type) {
      case 'bet': sound = betSound; break;
      case 'spin': sound = spinSound; break;
      case 'result': sound = resultSound; break;
      case 'win': sound = winSound; break;
      case 'click': sound = clickSound; break;
      case 'error': sound = errorSound; break;
      case 'spinning': sound = spinningSound; break;
      default: return;
    }
    
    sound.currentTime = 0;
    sound.play();
  } catch(e) {
    console.log("Error playing sound:", e);
  }
}

/* ========== AUDIO CONTROL FUNCTIONS ========== */
function toggleAudioPanel() {
  document.getElementById('audioPanel').classList.toggle('show');
}

// Set initial audio states
document.addEventListener('DOMContentLoaded', function() {
  // Initialize audio settings
  isMusicOn = false; // Default OFF
  isSfxOn = true;
  
  // Music controls
  const musicToggle = document.getElementById('musicToggle');
  const musicVolume = document.getElementById('musicVolume');
  
  // Set initial state
  bgMusic.pause();
  musicToggle.checked = false;
  bgMusic.volume = musicVolume.value;
  
  musicToggle.addEventListener('change', function() {
    isMusicOn = this.checked;
    if (isMusicOn) {
      bgMusic.play().catch(e => console.log("Autoplay prevented"));
      bgMusic.volume = musicVolume.value;
    } else {
      bgMusic.pause();
    }
  });
  
  musicVolume.addEventListener('input', function() {
    bgMusic.volume = this.value;
  });
  
  // SFX controls
  const sfxToggle = document.getElementById('sfxToggle');
  const sfxVolume = document.getElementById('sfxVolume');
  
  sfxToggle.addEventListener('change', function() {
    isSfxOn = this.checked;
  });
  
  sfxVolume.addEventListener('input', function() {
    betSound.volume = this.value;
    spinSound.volume = this.value;
    resultSound.volume = this.value;
    winSound.volume = this.value;
    clickSound.volume = this.value;
    errorSound.volume = this.value;
    spinningSound.volume = this.value;
  });
  
  // Set initial SFX volume
  betSound.volume = sfxVolume.value;
  spinSound.volume = sfxVolume.value;
  resultSound.volume = sfxVolume.value;
  winSound.volume = sfxVolume.value;
  clickSound.volume = sfxVolume.value;
  errorSound.volume = sfxVolume.value;
  
  // Load game data and start
  loadGameData();
  startBettingRound();
});

/* ---------- MULAI GAME ---------- */
// Prevent zooming on mobile devices
document.addEventListener('gesturestart', function(e) {
  e.preventDefault();
});

// Prevent double tap zoom
let lastTap = 0;
document.addEventListener('touchend', function(event) {
  const now = (new Date()).getTime();
  if (now - lastTap <= 300) {
    event.preventDefault();
  }
  lastTap = now;
}, false);

</script>

</body>
</html>
